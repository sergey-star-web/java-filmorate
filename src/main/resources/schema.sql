DROP TABLE IF EXISTS genres CASCADE;
CREATE TABLE IF NOT EXISTS genres
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    const TEXT NOT NULL
);

DROP TABLE IF EXISTS mpa_rating CASCADE;
CREATE TABLE IF NOT EXISTS mpa_rating
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT
);

CREATE SEQUENCE IF NOT EXISTS film_id_seq START WITH 1 INCREMENT BY 1;
ALTER SEQUENCE film_id_seq RESTART WITH 1;

DROP TABLE IF EXISTS films CASCADE;
CREATE TABLE IF NOT EXISTS films
(
    id BIGINT DEFAULT NEXT VALUE FOR film_id_seq PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT(200),
    releaseDate DATETIME,
    duration INTEGER,
    mpa_rating_id INTEGER REFERENCES mpa_rating (id)
);

DROP TABLE IF EXISTS genres_in_film CASCADE;
CREATE TABLE IF NOT EXISTS genres_in_film
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    film_id BIGINT NOT NULL,
    genre_id INTEGER REFERENCES genres (id) NOT NULL
);

CREATE SEQUENCE IF NOT EXISTS user_id_seq START WITH 1 INCREMENT BY 1;
ALTER SEQUENCE user_id_seq RESTART WITH 1;

DROP TABLE IF EXISTS users CASCADE;
CREATE TABLE IF NOT EXISTS users
(
    id BIGINT DEFAULT NEXT VALUE FOR user_id_seq PRIMARY KEY,
    email TEXT NOT NULL,
    login TEXT,
    name TEXT,
    birthday DATE
);

DROP TABLE IF EXISTS friends CASCADE;
CREATE TABLE IF NOT EXISTS friends
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_send_id BIGINT REFERENCES users (id) NOT NULL,
    user_received_id BIGINT REFERENCES users (id) NOT NULL,
    confirm_friendship_status BOOLEAN NOT NULL
);

DROP TABLE IF EXISTS likes CASCADE;
CREATE TABLE IF NOT EXISTS likes
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT REFERENCES users (id) NOT NULL,
    film_id BIGINT REFERENCES films (id) NOT NULL
);